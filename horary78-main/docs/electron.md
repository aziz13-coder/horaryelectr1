# Packaging with Electron

This guide explains how to bundle the backend Flask API and the React-based frontend into a single desktop application using Electron. It assumes you already have the project running as described in the main README.

## Prerequisites

- Node.js 16 or later
- npm 8 or later
- Python environment for the backend

## Steps

1. **Install Electron and electron-builder**
   Navigate to the `frontend/` directory and run:
   ```bash
   npm install --save-dev electron electron-builder
   ```

2. **Add build scripts**
   Update `frontend/package.json` with the following scripts:
   ```json
   "scripts": {
     "electron:dev": "concurrently \"npm run dev\" \"npm run start-backend\" \"npm run electron\"",
     "electron": "electron .",
     "start-backend": "cd ../backend && python app.py",
     "pack": "electron-builder --dir",
     "dist": "electron-builder"
   }
   ```

3. **Create `main.js`**
   Inside `frontend/`, create a `main.js` file that loads your built React assets and spawns the backend server if needed:
   ```javascript
   const { app, BrowserWindow } = require('electron');
   const path = require('path');
   const { spawn } = require('child_process');

   function createWindow() {
     const win = new BrowserWindow({ width: 800, height: 600 });
     win.loadFile(path.join(__dirname, 'dist/index.html'));
   }

   app.whenReady().then(() => {
     spawn('python', ['../backend/app.py'], { stdio: 'inherit' });
     createWindow();
   });
   ```

4. **Configure electron-builder**
   Add the following section to `frontend/package.json`:
   ```json
   "build": {
     "appId": "com.horary.app",
     "files": [
       "dist/**/*",
       "main.js"
     ],
     "directories": {
       "buildResources": "assets"
     }
   }
   ```

5. **Build the application**
   After running `npm run build` in the frontend and ensuring the backend works, package everything:
   ```bash
   npm run dist
   ```

The output installer can be found in the `dist/` directory generated by electron-builder.

## Running Electron

1. **Install dependencies**
   Navigate to the `frontend/` folder and install all Node modules:
   ```bash
   cd frontend
   npm install
   ```

2. **Start the development version**
   Use the helper script below to run the Vite dev server, backend API and Electron together:
   ```bash
   npm run electron:dev
   ```

3. **Build and run for production**
   First create the React build and then launch Electron with the compiled assets:
   ```bash
   npm run build
   npm run electron       # run the built version
   # or package everything into an installer
   npm run dist
   ```

The `main.js` file now checks `app.isPackaged` to decide whether to load the Vite
development server or the static `dist/index.html`. Running `electron:dev`
starts the app in development mode, while `electron` or `dist` use the packaged
files.

